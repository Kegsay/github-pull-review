[
  {
    "sha": "ed20db1c55f161e72b2f6c5c12212c7ae2bbe8bf",
    "filename": "tests/01http-server.pl",
    "status": "modified",
    "additions": 10,
    "deletions": 4,
    "changes": 14,
    "blob_url": "https://github.com/matrix-org/sytest/blob/df3c76bcccc8cc5e632f9127a52e6977a7847248/tests/01http-server.pl",
    "raw_url": "https://github.com/matrix-org/sytest/raw/df3c76bcccc8cc5e632f9127a52e6977a7847248/tests/01http-server.pl",
    "contents_url": "https://api.github.com/repos/matrix-org/sytest/contents/tests/01http-server.pl?ref=df3c76bcccc8cc5e632f9127a52e6977a7847248",
    "patch": "@@ -139,10 +139,16 @@ package SyTest::HTTPServer {\n \n       my $awaiter = extract_first_by {\n          my $pathmatch = $_->pathmatch;\n-         return 0 unless ( !ref $pathmatch and $path eq $pathmatch ) or\n-                         ( ref $pathmatch  and $path =~ $pathmatch );\n-\n-         return 0 if $_->filter and not $_->filter->( $request );\n+         if( ref $pathmatch ) {\n+            $path =~ $pathmatch or return 0;\n+         }\n+         else {\n+            $path eq $pathmatch or return 0;\n+         }\n+\n+         if( $_->filter ) {\n+            $_->filter->( $request ) or return 0;\n+         }\n \n          return 1;\n       } @pending_awaiters;"
  },
  {
    "sha": "12e129401c9ef60a962e7587ccae94d5866ab875",
    "filename": "tests/10apidoc/01register.pl",
    "status": "modified",
    "additions": 4,
    "deletions": 2,
    "changes": 6,
    "blob_url": "https://github.com/matrix-org/sytest/blob/df3c76bcccc8cc5e632f9127a52e6977a7847248/tests/10apidoc/01register.pl",
    "raw_url": "https://github.com/matrix-org/sytest/raw/df3c76bcccc8cc5e632f9127a52e6977a7847248/tests/10apidoc/01register.pl",
    "contents_url": "https://api.github.com/repos/matrix-org/sytest/contents/tests/10apidoc/01register.pl?ref=df3c76bcccc8cc5e632f9127a52e6977a7847248",
    "patch": "@@ -126,7 +126,8 @@ sub local_user_fixture\n          matrix_register_user( $api_client )\n          ->then_with_f( sub {\n             my $f = shift;\n-            return $f unless defined( my $displayname = $args{displayname} );\n+            defined( my $displayname = $args{displayname} ) or\n+               return $f;\n \n             my $user = $f->get;\n             do_request_json_for( $user,\n@@ -137,7 +138,8 @@ sub local_user_fixture\n             )->then_done( $user );\n          })->then_with_f( sub {\n             my $f = shift;\n-            return $f unless defined( my $presence = $args{presence} );\n+            defined( my $presence = $args{presence} ) or\n+               return $f;\n \n             my $user = $f->get;\n             do_request_json_for( $user,"
  },
  {
    "sha": "cef22e687578c2deff08d09eb597c076db8e38ec",
    "filename": "tests/10apidoc/33room-members.pl",
    "status": "modified",
    "additions": 8,
    "deletions": 4,
    "changes": 12,
    "blob_url": "https://github.com/matrix-org/sytest/blob/df3c76bcccc8cc5e632f9127a52e6977a7847248/tests/10apidoc/33room-members.pl",
    "raw_url": "https://github.com/matrix-org/sytest/raw/df3c76bcccc8cc5e632f9127a52e6977a7847248/tests/10apidoc/33room-members.pl",
    "contents_url": "https://api.github.com/repos/matrix-org/sytest/contents/tests/10apidoc/33room-members.pl?ref=df3c76bcccc8cc5e632f9127a52e6977a7847248",
    "patch": "@@ -357,7 +357,7 @@ sub matrix_create_and_join_room\n             )\n          } @local_members )\n    })->then( sub {\n-      return Future->done( $room_id ) unless $n_joiners;\n+      $n_joiners or return Future->done( $room_id );\n \n       # Now wait for the creator to see every join event, so we're sure\n       # the remote joins have happened\n@@ -370,12 +370,16 @@ sub matrix_create_and_join_room\n          await_event_for( $creator, sub {\n             my ( $event ) = @_;\n \n-            return unless $event->{type} eq \"m.room.member\";\n-            return unless $event->{room_id} eq $room_id;\n+            $event->{type} eq \"m.room.member\" or\n+               return 0;\n+            $event->{room_id} eq $room_id or\n+               return 0;\n \n             $joined_members{ $event->{state_key} }++;\n \n-            return 1 if keys( %joined_members ) == $n_joiners;\n+            keys( %joined_members ) == $n_joiners\n+               and return 1;\n+\n             return 0;\n          }),\n "
  },
  {
    "sha": "79f07f7dc1063dcacf86bbfee88f462e42caf4cc",
    "filename": "tests/20profile-events.pl",
    "status": "modified",
    "additions": 12,
    "deletions": 4,
    "changes": 16,
    "blob_url": "https://github.com/matrix-org/sytest/blob/df3c76bcccc8cc5e632f9127a52e6977a7847248/tests/20profile-events.pl",
    "raw_url": "https://github.com/matrix-org/sytest/raw/df3c76bcccc8cc5e632f9127a52e6977a7847248/tests/20profile-events.pl",
    "contents_url": "https://api.github.com/repos/matrix-org/sytest/contents/tests/20profile-events.pl?ref=df3c76bcccc8cc5e632f9127a52e6977a7847248",
    "patch": "@@ -20,9 +20,13 @@\n       })->then( sub {\n          await_event_for( $user, sub {\n             my ( $event ) = @_;\n-            return unless $event->{type} eq \"m.presence\";\n+\n+            $event->{type} eq \"m.presence\" or\n+               return 0;\n+\n             my $content = $event->{content};\n-            return unless $content->{user_id} eq $user->user_id;\n+            $content->{user_id} eq $user->user_id or\n+               return 0;\n \n             $content->{displayname} eq $displayname or\n                die \"Expected displayname to be '$displayname'\";\n@@ -49,9 +53,13 @@\n       )->then( sub {\n          await_event_for( $user, sub {\n             my ( $event ) = @_;\n-            return unless $event->{type} eq \"m.presence\";\n+\n+            $event->{type} eq \"m.presence\" or\n+               return 0;\n+\n             my $content = $event->{content};\n-            return unless $content->{user_id} eq $user->user_id;\n+            $content->{user_id} eq $user->user_id or\n+               return 0;\n \n             $content->{avatar_url} eq $avatar_url or\n                die \"Expected avatar_url to be '$avatar_url'\";"
  },
  {
    "sha": "4fc55308e1dc081f58dcd510a30b196b9948c05a",
    "filename": "tests/21presence-events.pl",
    "status": "modified",
    "additions": 5,
    "deletions": 2,
    "changes": 7,
    "blob_url": "https://github.com/matrix-org/sytest/blob/df3c76bcccc8cc5e632f9127a52e6977a7847248/tests/21presence-events.pl",
    "raw_url": "https://github.com/matrix-org/sytest/raw/df3c76bcccc8cc5e632f9127a52e6977a7847248/tests/21presence-events.pl",
    "contents_url": "https://api.github.com/repos/matrix-org/sytest/contents/tests/21presence-events.pl?ref=df3c76bcccc8cc5e632f9127a52e6977a7847248",
    "patch": "@@ -88,12 +88,15 @@\n       })->then( sub {\n          await_event_for( $user, sub {\n             my ( $event ) = @_;\n-            return unless $event->{type} eq \"m.presence\";\n+\n+            $event->{type} eq \"m.presence\" or\n+               return 0;\n \n             my $content = $event->{content};\n             require_json_keys( $content, qw( user_id ));\n \n-            return unless $content->{user_id} eq $friend->user_id;\n+            $content->{user_id} eq $friend->user_id or\n+               return 0;\n \n             require_json_keys( $content, qw( presence status_msg ));\n             $content->{presence} eq \"online\" or"
  },
  {
    "sha": "c468c3618240e08a911c0218f6ec603f070db58d",
    "filename": "tests/30rooms/01state.pl",
    "status": "modified",
    "additions": 20,
    "deletions": 7,
    "changes": 27,
    "blob_url": "https://github.com/matrix-org/sytest/blob/df3c76bcccc8cc5e632f9127a52e6977a7847248/tests/30rooms/01state.pl",
    "raw_url": "https://github.com/matrix-org/sytest/raw/df3c76bcccc8cc5e632f9127a52e6977a7847248/tests/30rooms/01state.pl",
    "contents_url": "https://api.github.com/repos/matrix-org/sytest/contents/tests/30rooms/01state.pl?ref=df3c76bcccc8cc5e632f9127a52e6977a7847248",
    "patch": "@@ -24,9 +24,13 @@\n \n       await_event_for( $user, sub {\n          my ( $event ) = @_;\n-         return unless $event->{type} eq \"m.room.create\";\n+\n+         $event->{type} eq \"m.room.create\" or\n+            return 0;\n+\n          require_json_keys( $event, qw( room_id user_id content ));\n-         return unless $event->{room_id} eq $room_id;\n+         $event->{room_id} eq $room_id or\n+            return 0;\n \n          $event->{user_id} eq $user->user_id or\n             die \"Expected user_id to be ${\\$user->user_id}\";\n@@ -47,10 +51,15 @@\n \n       await_event_for( $user, sub {\n          my ( $event ) = @_;\n-         return unless $event->{type} eq \"m.room.member\";\n+\n+         $event->{type} eq \"m.room.member\" or\n+            return 0;\n+\n          require_json_keys( $event, qw( room_id user_id state_key content ));\n-         return unless $event->{room_id} eq $room_id;\n-         return unless $event->{state_key} eq $user->user_id;\n+         $event->{room_id} eq $room_id or\n+            return 0;\n+         $event->{state_key} eq $user->user_id or\n+            return 0;\n \n          require_json_keys( my $content = $event->{content}, qw( membership ));\n \n@@ -76,9 +85,13 @@\n       )->then( sub {\n          await_event_for( $user, sub {\n             my ( $event ) = @_;\n-            return unless $event->{type} eq \"m.room.topic\";\n+\n+            $event->{type} eq \"m.room.topic\" or\n+               return 0;\n+\n             require_json_keys( $event, qw( room_id user_id content ));\n-            return unless $event->{room_id} eq $room_id;\n+            $event->{room_id} eq $room_id or\n+               return 0;\n \n             $event->{user_id} eq $user->user_id or\n                die \"Expected user_id to be ${\\$user->user_id}\";"
  },
  {
    "sha": "24836615cf448d90a4981ca94a851f0303146ecb",
    "filename": "tests/30rooms/02members-local.pl",
    "status": "modified",
    "additions": 21,
    "deletions": 8,
    "changes": 29,
    "blob_url": "https://github.com/matrix-org/sytest/blob/df3c76bcccc8cc5e632f9127a52e6977a7847248/tests/30rooms/02members-local.pl",
    "raw_url": "https://github.com/matrix-org/sytest/raw/df3c76bcccc8cc5e632f9127a52e6977a7847248/tests/30rooms/02members-local.pl",
    "contents_url": "https://api.github.com/repos/matrix-org/sytest/contents/tests/30rooms/02members-local.pl?ref=df3c76bcccc8cc5e632f9127a52e6977a7847248",
    "patch": "@@ -38,11 +38,15 @@\n \n       await_event_for( $local_user, sub {\n          my ( $event ) = @_;\n-         return unless $event->{type} eq \"m.room.member\";\n+\n+         $event->{type} eq \"m.room.member\" or\n+            return 0;\n \n          require_json_keys( $event, qw( type room_id user_id ));\n-         return unless $event->{room_id} eq $room_id;\n-         return unless $event->{user_id} eq $local_user->user_id;\n+         $event->{room_id} eq $room_id or\n+            return 0;\n+         $event->{user_id} eq $local_user->user_id or\n+            return 0;\n \n          require_json_keys( my $content = $event->{content}, qw( membership ));\n \n@@ -89,10 +93,15 @@\n \n       await_event_for( $first_user, sub {\n          my ( $event ) = @_;\n-         return unless $event->{type} eq \"m.room.member\";\n+\n+         $event->{type} eq \"m.room.member\" or\n+            return 0;\n+\n          require_json_keys( $event, qw( type room_id user_id ));\n-         return unless $event->{room_id} eq $room_id;\n-         return unless $event->{user_id} eq $local_user->user_id;\n+         $event->{room_id} eq $room_id or\n+            return 0;\n+         $event->{user_id} eq $local_user->user_id or\n+            return 0;\n \n          require_json_keys( my $content = $event->{content}, qw( membership ));\n \n@@ -111,10 +120,14 @@\n \n       await_event_for( $first_user, sub {\n          my ( $event ) = @_;\n-         return unless $event->{type} eq \"m.presence\";\n+\n+         $event->{type} eq \"m.presence\" or\n+            return 0;\n+\n          require_json_keys( $event, qw( type content ));\n          require_json_keys( my $content = $event->{content}, qw( user_id presence ));\n-         return unless $content->{user_id} eq $local_user->user_id;\n+         $content->{user_id} eq $local_user->user_id or\n+            return 0;\n \n          return 1;\n       });"
  },
  {
    "sha": "701401bf739fe4bceefa34ccceb1f9feed8c99de",
    "filename": "tests/30rooms/03members-remote.pl",
    "status": "modified",
    "additions": 22,
    "deletions": 8,
    "changes": 30,
    "blob_url": "https://github.com/matrix-org/sytest/blob/df3c76bcccc8cc5e632f9127a52e6977a7847248/tests/30rooms/03members-remote.pl",
    "raw_url": "https://github.com/matrix-org/sytest/raw/df3c76bcccc8cc5e632f9127a52e6977a7847248/tests/30rooms/03members-remote.pl",
    "contents_url": "https://api.github.com/repos/matrix-org/sytest/contents/tests/30rooms/03members-remote.pl?ref=df3c76bcccc8cc5e632f9127a52e6977a7847248",
    "patch": "@@ -67,11 +67,15 @@\n \n       await_event_for( $user, sub {\n          my ( $event ) = @_;\n-         return unless $event->{type} eq \"m.room.member\";\n+\n+         $event->{type} eq \"m.room.member\" or\n+            return 0;\n \n          require_json_keys( $event, qw( type room_id user_id ));\n-         return unless $event->{room_id} eq $room_id;\n-         return unless $event->{user_id} eq $user->user_id;\n+         $event->{room_id} eq $room_id or\n+            return 0;\n+         $event->{user_id} eq $user->user_id or\n+            return 0;\n \n          require_json_keys( my $content = $event->{content}, qw( membership ));\n \n@@ -122,10 +126,15 @@\n \n       await_event_for( $first_user, sub {\n          my ( $event ) = @_;\n-         return unless $event->{type} eq \"m.room.member\";\n+\n+         $event->{type} eq \"m.room.member\" or\n+            return 0;\n+\n          require_json_keys( $event, qw( type room_id user_id ));\n-         return unless $event->{room_id} eq $room_id;\n-         return unless $event->{user_id} eq $user->user_id;\n+         $event->{room_id} eq $room_id or\n+            return 0;\n+         $event->{user_id} eq $user->user_id or\n+            return 0;\n \n          require_json_keys( my $content = $event->{content}, qw( membership ));\n \n@@ -145,10 +154,15 @@\n \n       await_event_for( $first_user, sub {\n          my ( $event ) = @_;\n-         return unless $event->{type} eq \"m.presence\";\n+\n+         $event->{type} eq \"m.presence\" or\n+            return 0;\n+\n          require_json_keys( $event, qw( type content ));\n          require_json_keys( my $content = $event->{content}, qw( user_id presence ));\n-         return unless $content->{user_id} eq $user->user_id;\n+\n+         $content->{user_id} eq $user->user_id or\n+            return 0;\n \n          return 1;\n       });"
  },
  {
    "sha": "72dd4bd7d138a8a706fe08af84e360bd66b30d3e",
    "filename": "tests/30rooms/04messages.pl",
    "status": "modified",
    "additions": 14,
    "deletions": 6,
    "changes": 20,
    "blob_url": "https://github.com/matrix-org/sytest/blob/df3c76bcccc8cc5e632f9127a52e6977a7847248/tests/30rooms/04messages.pl",
    "raw_url": "https://github.com/matrix-org/sytest/raw/df3c76bcccc8cc5e632f9127a52e6977a7847248/tests/30rooms/04messages.pl",
    "contents_url": "https://api.github.com/repos/matrix-org/sytest/contents/tests/30rooms/04messages.pl?ref=df3c76bcccc8cc5e632f9127a52e6977a7847248",
    "patch": "@@ -28,12 +28,15 @@\n \n             await_event_for( $recvuser, sub {\n                my ( $event ) = @_;\n-               return unless $event->{type} eq \"m.room.message\";\n+\n+               $event->{type} eq \"m.room.message\" or\n+                  return 0;\n \n                require_json_keys( $event, qw( type content room_id user_id ));\n                require_json_keys( my $content = $event->{content}, qw( msgtype body ));\n \n-               return unless $event->{room_id} eq $room_id;\n+               $event->{room_id} eq $room_id or\n+                  return 0;\n \n                $content->{msgtype} eq $msgtype or\n                   die \"Expected msgtype as $msgtype\";\n@@ -94,10 +97,12 @@\n             my ( $event ) = @_;\n             log_if_fail \"Received event:\", $event;\n \n-            return unless $event->{type} eq \"m.room.message\";\n+            $event->{type} eq \"m.room.message\" or\n+               return 0;\n \n             require_json_keys( $event, qw( type content room_id user_id ));\n-            return unless $event->{room_id} eq $room_id;\n+            $event->{room_id} eq $room_id or\n+               return 0;\n \n             die \"Nonmember received event about a room they're not a member of\";\n          }),\n@@ -153,12 +158,15 @@\n \n       await_event_for( $remote_user, sub {\n          my ( $event ) = @_;\n-         return unless $event->{type} eq \"m.room.message\";\n+\n+         $event->{type} eq \"m.room.message\" or\n+            return 0;\n \n          require_json_keys( $event, qw( type content room_id user_id ));\n          require_json_keys( my $content = $event->{content}, qw( msgtype body ));\n \n-         return unless $event->{room_id} eq $room_id;\n+         $event->{room_id} eq $room_id or\n+            return 0;\n \n          $content->{msgtype} eq $msgtype or\n             die \"Expected msgtype as $msgtype\";"
  },
  {
    "sha": "50d40f526af3868963589c95a8edfd3f1eaff2c4",
    "filename": "tests/30rooms/06invite.pl",
    "status": "modified",
    "additions": 7,
    "deletions": 3,
    "changes": 10,
    "blob_url": "https://github.com/matrix-org/sytest/blob/df3c76bcccc8cc5e632f9127a52e6977a7847248/tests/30rooms/06invite.pl",
    "raw_url": "https://github.com/matrix-org/sytest/raw/df3c76bcccc8cc5e632f9127a52e6977a7847248/tests/30rooms/06invite.pl",
    "contents_url": "https://api.github.com/repos/matrix-org/sytest/contents/tests/30rooms/06invite.pl?ref=df3c76bcccc8cc5e632f9127a52e6977a7847248",
    "patch": "@@ -76,11 +76,15 @@ sub inviteonly_room_fixture\n          my ( $event ) = @_;\n \n          require_json_keys( $event, qw( type ));\n-         return 0 unless $event->{type} eq \"m.room.member\";\n+         $event->{type} eq \"m.room.member\" or\n+            return 0;\n \n          require_json_keys( $event, qw( room_id state_key ));\n-         return 0 unless $event->{room_id} eq $room_id;\n-         return 0 unless $event->{state_key} eq $invitee->user_id;\n+\n+         $event->{room_id} eq $room_id or\n+            return 0;\n+         $event->{state_key} eq $invitee->user_id or\n+            return 0;\n \n          require_json_keys( my $content = $event->{content}, qw( membership ));\n "
  },
  {
    "sha": "d7704c70db42864ffa80b05881b1f83e0ce62bb2",
    "filename": "tests/30rooms/09eventstream.pl",
    "status": "modified",
    "additions": 5,
    "deletions": 3,
    "changes": 8,
    "blob_url": "https://github.com/matrix-org/sytest/blob/df3c76bcccc8cc5e632f9127a52e6977a7847248/tests/30rooms/09eventstream.pl",
    "raw_url": "https://github.com/matrix-org/sytest/raw/df3c76bcccc8cc5e632f9127a52e6977a7847248/tests/30rooms/09eventstream.pl",
    "contents_url": "https://api.github.com/repos/matrix-org/sytest/contents/tests/30rooms/09eventstream.pl?ref=df3c76bcccc8cc5e632f9127a52e6977a7847248",
    "patch": "@@ -39,9 +39,11 @@\n          # Wait for the message we just sent.\n          await_event_for( $alice, sub {\n             my ( $event ) = @_;\n-            return unless $event->{type} eq \"m.room.message\";\n-            return unless $event->{event_id} eq $event_id;\n-            return 1;\n+\n+            $event->{type} eq \"m.room.message\" or\n+               return 0;\n+\n+            return $event->{event_id} eq $event_id;\n          })->SyTest::pass_on_done( \"Alice saw her message\" )\n       })->then_done(1);\n    };"
  },
  {
    "sha": "742d8cabca6e8654e2c9dcc835315d7e02b14ea9",
    "filename": "tests/30rooms/13anonymousaccess.pl",
    "status": "modified",
    "additions": 4,
    "deletions": 1,
    "changes": 5,
    "blob_url": "https://github.com/matrix-org/sytest/blob/df3c76bcccc8cc5e632f9127a52e6977a7847248/tests/30rooms/13anonymousaccess.pl",
    "raw_url": "https://github.com/matrix-org/sytest/raw/df3c76bcccc8cc5e632f9127a52e6977a7847248/tests/30rooms/13anonymousaccess.pl",
    "contents_url": "https://api.github.com/repos/matrix-org/sytest/contents/tests/30rooms/13anonymousaccess.pl?ref=df3c76bcccc8cc5e632f9127a52e6977a7847248",
    "patch": "@@ -297,8 +297,11 @@ sub check_events\n       foreach my $event ( @{ $body->{chunk} } ) {\n          next if all { $_ ne \"content\" } keys %{ $event };\n          next if all { $_ ne \"body\" } keys %{ $event->{content} };\n+\n          $found = 1 if $event->{content}->{body} eq \"public\";\n-         die \"Should not have found private\" if $event->{content}->{body} eq \"private\";\n+\n+         $event->{content}->{body} eq \"private\" and\n+            die \"Should not have found private\";\n       }\n \n       Future->done( $found );"
  },
  {
    "sha": "b56dc79784e3ffce1dbf41d1e325851517d497c3",
    "filename": "tests/30rooms/20typing.pl",
    "status": "modified",
    "additions": 25,
    "deletions": 12,
    "changes": 37,
    "blob_url": "https://github.com/matrix-org/sytest/blob/df3c76bcccc8cc5e632f9127a52e6977a7847248/tests/30rooms/20typing.pl",
    "raw_url": "https://github.com/matrix-org/sytest/raw/df3c76bcccc8cc5e632f9127a52e6977a7847248/tests/30rooms/20typing.pl",
    "contents_url": "https://api.github.com/repos/matrix-org/sytest/contents/tests/30rooms/20typing.pl?ref=df3c76bcccc8cc5e632f9127a52e6977a7847248",
    "patch": "@@ -52,12 +52,14 @@ sub matrix_typing\n             await_event_for( $recvuser, sub {\n                my ( $event ) = @_;\n \n-               return unless $event->{type} eq \"m.typing\";\n+               $event->{type} eq \"m.typing\" or\n+                  return 0;\n \n                require_json_keys( $event, qw( type room_id content ));\n                require_json_keys( my $content = $event->{content}, qw( user_ids ));\n \n-               return unless $event->{room_id} eq $room_id;\n+               $event->{room_id} eq $room_id or\n+                  return 0;\n \n                require_json_list( my $users = $content->{user_ids} );\n \n@@ -83,12 +85,14 @@ sub matrix_typing\n       await_event_for( $remote_user, sub {\n          my ( $event ) = @_;\n \n-         return unless $event->{type} eq \"m.typing\";\n+         $event->{type} eq \"m.typing\" or\n+            return 0;\n \n          require_json_keys( $event, qw( type room_id content ));\n          require_json_keys( my $content = $event->{content}, qw( user_ids ));\n \n-         return unless $event->{room_id} eq $room_id;\n+         $event->{room_id} eq $room_id or\n+            return 0;\n \n          require_json_list( my $users = $content->{user_ids} );\n \n@@ -116,12 +120,14 @@ sub matrix_typing\n             await_event_for( $recvuser, sub {\n                my ( $event ) = @_;\n \n-               return unless $event->{type} eq \"m.typing\";\n+               $event->{type} eq \"m.typing\" or\n+                  return 0;\n \n                require_json_keys( $event, qw( type room_id content ));\n                require_json_keys( my $content = $event->{content}, qw( user_ids ));\n \n-               return unless $event->{room_id} eq $room_id;\n+               $event->{room_id} eq $room_id or\n+                  return 0;\n \n                require_json_list( my $users = $content->{user_ids} );\n \n@@ -155,10 +161,14 @@ sub matrix_typing\n          # start typing\n          await_event_for( $user, sub {\n             my ( $event ) = @_;\n-            return unless $event->{type} eq \"m.typing\";\n-            return unless $event->{room_id} eq $room_id;\n \n-            return unless scalar @{ $event->{content}{user_ids} };\n+            $event->{type} eq \"m.typing\" or\n+               return 0;\n+            $event->{room_id} eq $room_id or\n+               return 0;\n+\n+            scalar @{ $event->{content}{user_ids} } or\n+               return 0;\n \n             pass( \"Received start notification\" );\n             return 1;\n@@ -167,10 +177,13 @@ sub matrix_typing\n          # stop typing\n          await_event_for( $user, sub {\n             my ( $event ) = @_;\n-            return unless $event->{type} eq \"m.typing\";\n-            return unless $event->{room_id} eq $room_id;\n \n-            return if scalar @{ $event->{content}{user_ids} };\n+            $event->{type} eq \"m.typing\" or\n+               return 0;\n+            $event->{room_id} eq $room_id or\n+               return 0;\n+\n+            @{ $event->{content}{user_ids} } == 0 or return;\n \n             ( time() - $start_time ) < 0.5 or\n                die \"Took too long to time out\";"
  },
  {
    "sha": "526fd64690713721bbaf55e47dd28f4aaa42086e",
    "filename": "tests/40presence.pl",
    "status": "modified",
    "additions": 19,
    "deletions": 8,
    "changes": 27,
    "blob_url": "https://github.com/matrix-org/sytest/blob/df3c76bcccc8cc5e632f9127a52e6977a7847248/tests/40presence.pl",
    "raw_url": "https://github.com/matrix-org/sytest/raw/df3c76bcccc8cc5e632f9127a52e6977a7847248/tests/40presence.pl",
    "contents_url": "https://api.github.com/repos/matrix-org/sytest/contents/tests/40presence.pl?ref=df3c76bcccc8cc5e632f9127a52e6977a7847248",
    "patch": "@@ -32,7 +32,9 @@\n \n             await_event_for( $recvuser, sub {\n                my ( $event ) = @_;\n-               return unless $event->{type} eq \"m.presence\";\n+\n+               $event->{type} eq \"m.presence\" or\n+                  return 0;\n \n                require_json_keys( $event, qw( type content ));\n                require_json_keys( my $content = $event->{content},\n@@ -61,7 +63,9 @@\n \n       await_event_for( $remote_user, sub {\n          my ( $event ) = @_;\n-         return unless $event->{type} eq \"m.presence\";\n+\n+         $event->{type} eq \"m.presence\" or\n+            return 0;\n \n          require_json_keys( $event, qw( type content ));\n          require_json_keys( my $content = $event->{content},\n@@ -97,12 +101,16 @@\n \n             await_event_for( $recvuser, sub {\n                my ( $event ) = @_;\n-               return unless $event->{type} eq \"m.presence\";\n+\n+               $event->{type} eq \"m.presence\" or\n+                  return 0;\n \n                my $content = $event->{content};\n-               return unless $content->{user_id} eq $senduser->user_id;\n+               $content->{user_id} eq $senduser->user_id or\n+                  return 0;\n \n-               return unless $content->{presence} eq \"offline\";\n+               $content->{presence} eq \"offline\" or\n+                  return 0;\n \n                return 1;\n             })\n@@ -120,12 +128,15 @@\n       await_event_for( $remote_user, sub {\n          my ( $event ) = @_;\n \n-         return unless $event->{type} eq \"m.presence\";\n+         $event->{type} eq \"m.presence\" or\n+            return 0;\n \n          my $content = $event->{content};\n-         return unless $content->{user_id} eq $senduser->user_id;\n+         $content->{user_id} eq $senduser->user_id or\n+            return 0;\n \n-         return unless $content->{presence} eq \"offline\";\n+         $content->{presence} eq \"offline\" or\n+            return 0;\n \n          return 1;\n       });"
  },
  {
    "sha": "3075dd40a7ca0702bd76e5c5e63e6bbaf70ff20d",
    "filename": "tests/42tags.pl",
    "status": "modified",
    "additions": 6,
    "deletions": 2,
    "changes": 8,
    "blob_url": "https://github.com/matrix-org/sytest/blob/df3c76bcccc8cc5e632f9127a52e6977a7847248/tests/42tags.pl",
    "raw_url": "https://github.com/matrix-org/sytest/raw/df3c76bcccc8cc5e632f9127a52e6977a7847248/tests/42tags.pl",
    "contents_url": "https://api.github.com/repos/matrix-org/sytest/contents/tests/42tags.pl?ref=df3c76bcccc8cc5e632f9127a52e6977a7847248",
    "patch": "@@ -219,8 +219,12 @@ sub check_tag_event {\n \n          await_event_for( $user, sub {\n             my ( $event ) = @_;\n-            return unless $event->{type} eq \"m.tag\"\n-               and $event->{room_id} eq $room_id;\n+\n+            $event->{type} eq \"m.tag\" or\n+               return 0;\n+\n+            $event->{room_id} eq $room_id or\n+               return 0;\n \n             check_tag_event( $event );\n "
  },
  {
    "sha": "bd756de37356ef8a9e90daf5cfc632583f0daf04",
    "filename": "tests/60app-services/02ghost.pl",
    "status": "modified",
    "additions": 10,
    "deletions": 4,
    "changes": 14,
    "blob_url": "https://github.com/matrix-org/sytest/blob/df3c76bcccc8cc5e632f9127a52e6977a7847248/tests/60app-services/02ghost.pl",
    "raw_url": "https://github.com/matrix-org/sytest/raw/df3c76bcccc8cc5e632f9127a52e6977a7847248/tests/60app-services/02ghost.pl",
    "contents_url": "https://api.github.com/repos/matrix-org/sytest/contents/tests/60app-services/02ghost.pl?ref=df3c76bcccc8cc5e632f9127a52e6977a7847248",
    "patch": "@@ -78,8 +78,11 @@\n       ->then( sub {\n          await_event_for( $creator, sub {\n             my ( $event ) = @_;\n-            return unless $event->{type} eq \"m.room.message\";\n-            return unless $event->{room_id} eq $room_id;\n+\n+            $event->{type} eq \"m.room.message\" or\n+               return 0;\n+            $event->{room_id} eq $room_id or\n+               return 0;\n \n             log_if_fail \"Event\", $event;\n \n@@ -157,8 +160,11 @@\n       ->then( sub {\n          await_event_for( $creator, sub {\n             my ( $event ) = @_;\n-            return unless $event->{type} eq \"m.room.message\";\n-            return unless $event->{room_id} eq $room_id;\n+\n+            $event->{type} eq \"m.room.message\" or\n+               return 0;\n+            $event->{room_id} eq $room_id or\n+               return 0;\n \n             log_if_fail \"Event\", $event;\n "
  },
  {
    "sha": "f1bb8430b305e220f21728865e61f582a12fbf84",
    "filename": "tests/61push/01message-pushed.pl",
    "status": "modified",
    "additions": 9,
    "deletions": 7,
    "changes": 16,
    "blob_url": "https://github.com/matrix-org/sytest/blob/df3c76bcccc8cc5e632f9127a52e6977a7847248/tests/61push/01message-pushed.pl",
    "raw_url": "https://github.com/matrix-org/sytest/raw/df3c76bcccc8cc5e632f9127a52e6977a7847248/tests/61push/01message-pushed.pl",
    "contents_url": "https://api.github.com/repos/matrix-org/sytest/contents/tests/61push/01message-pushed.pl?ref=df3c76bcccc8cc5e632f9127a52e6977a7847248",
    "patch": "@@ -43,11 +43,10 @@\n          Future->needs_all(\n             await_event_for( $bob, sub {\n                my ( $event ) = @_;\n-               return unless $event->{type} eq \"m.room.member\" and\n-                  $event->{room_id} eq $room_id and\n-                  $event->{state_key} eq $bob->user_id and\n-                  $event->{content}{membership} eq \"invite\";\n-               return 1;\n+               return $event->{type} eq \"m.room.member\" &&\n+                      $event->{room_id} eq $room_id &&\n+                      $event->{state_key} eq $bob->user_id &&\n+                      $event->{content}{membership} eq \"invite\";\n             })->SyTest::pass_on_done( \"Bob received invite\" ),\n \n             matrix_invite_user_to_room( $alice, $bob, $room_id ),\n@@ -86,8 +85,11 @@\n                my ( $request ) = @_;\n                my $body = $request->body_from_json;\n \n-               return unless $body->{notification}{type};\n-               return unless $body->{notification}{type} eq \"m.room.message\";\n+               $body->{notification}{type} or\n+                  return 0;\n+               $body->{notification}{type} eq \"m.room.message\" or\n+                  return 0;\n+\n                return 1;\n             })->then( sub {\n                my ( $request ) = @_;"
  },
  {
    "sha": "5d7d045b1f23c0d03788a0f066b5cb1361b5e2d1",
    "filename": "tests/90jira/SYN-115.pl",
    "status": "modified",
    "additions": 4,
    "deletions": 5,
    "changes": 9,
    "blob_url": "https://github.com/matrix-org/sytest/blob/df3c76bcccc8cc5e632f9127a52e6977a7847248/tests/90jira/SYN-115.pl",
    "raw_url": "https://github.com/matrix-org/sytest/raw/df3c76bcccc8cc5e632f9127a52e6977a7847248/tests/90jira/SYN-115.pl",
    "contents_url": "https://api.github.com/repos/matrix-org/sytest/contents/tests/90jira/SYN-115.pl?ref=df3c76bcccc8cc5e632f9127a52e6977a7847248",
    "patch": "@@ -30,12 +30,11 @@\n          # Bob should receive the invite\n          await_event_for( $bob, sub {\n             my ( $event ) = @_;\n-            return unless $event->{type} eq \"m.room.member\" and\n-                          $event->{room_id} eq $room_id and\n-                          $event->{state_key} eq $bob->user_id and\n-                          $event->{content}{membership} eq \"invite\";\n \n-            return 1;\n+            return $event->{type} eq \"m.room.member\" &&\n+                   $event->{room_id} eq $room_id &&\n+                   $event->{state_key} eq $bob->user_id &&\n+                   $event->{content}{membership} eq \"invite\";\n          })->SyTest::pass_on_done( \"Received invite\" )\n       })->then( sub {\n "
  },
  {
    "sha": "7910a07ec5e22904c135827a93d86891727953b5",
    "filename": "tests/90jira/SYN-205.pl",
    "status": "modified",
    "additions": 4,
    "deletions": 5,
    "changes": 9,
    "blob_url": "https://github.com/matrix-org/sytest/blob/df3c76bcccc8cc5e632f9127a52e6977a7847248/tests/90jira/SYN-205.pl",
    "raw_url": "https://github.com/matrix-org/sytest/raw/df3c76bcccc8cc5e632f9127a52e6977a7847248/tests/90jira/SYN-205.pl",
    "contents_url": "https://api.github.com/repos/matrix-org/sytest/contents/tests/90jira/SYN-205.pl?ref=df3c76bcccc8cc5e632f9127a52e6977a7847248",
    "patch": "@@ -13,12 +13,11 @@\n \n          await_event_for( $invitee, sub {\n             my ( $event ) = @_;\n-            return unless $event->{type} eq \"m.room.member\" and\n-                          $event->{room_id} eq $room_id and\n-                          $event->{state_key} eq $invitee->user_id and\n-                          $event->{content}{membership} eq \"invite\";\n \n-            return 1;\n+            return $event->{type} eq \"m.room.member\" &&\n+                   $event->{room_id} eq $room_id &&\n+                   $event->{state_key} eq $invitee->user_id &&\n+                   $event->{content}{membership} eq \"invite\";\n          })->SyTest::pass_on_done( \"Invitee received invite event\" )\n       })->then_done(1);\n    };"
  },
  {
    "sha": "8c67aced523b39a2830ec5f4884b328e0820aa51",
    "filename": "tests/90jira/SYN-328.pl",
    "status": "modified",
    "additions": 4,
    "deletions": 6,
    "changes": 10,
    "blob_url": "https://github.com/matrix-org/sytest/blob/df3c76bcccc8cc5e632f9127a52e6977a7847248/tests/90jira/SYN-328.pl",
    "raw_url": "https://github.com/matrix-org/sytest/raw/df3c76bcccc8cc5e632f9127a52e6977a7847248/tests/90jira/SYN-328.pl",
    "contents_url": "https://api.github.com/repos/matrix-org/sytest/contents/tests/90jira/SYN-328.pl?ref=df3c76bcccc8cc5e632f9127a52e6977a7847248",
    "patch": "@@ -24,10 +24,9 @@\n \n             await_event_for( $recvuser, sub {\n                my ( $event ) = @_;\n-               return unless $event->{type} eq \"m.typing\";\n-               return unless $event->{room_id} eq $room_id;\n \n-               return 1;\n+               return $event->{type} eq \"m.typing\" &&\n+                      $event->{room_id} eq $room_id;\n             })\n          } $creator, $member )\n             ->SyTest::pass_on_done( \"Members received notification\" )\n@@ -38,10 +37,9 @@\n \n             await_event_for( $nonmember, sub {\n                my ( $event ) = @_;\n-               return unless $event->{type} eq \"m.typing\";\n-               return unless $event->{room_id} eq $room_id;\n \n-               return 1;\n+               return $event->{type} eq \"m.typing\" &&\n+                      $event->{room_id} eq $room_id;\n             })->then_fail( \"Received unexpected typing notification\" ),\n          )->SyTest::pass_on_done( \"Non-member did not receive it up to timeout\" )\n       })->then_done(1);"
  },
  {
    "sha": "274defafe725ccdc613804148d1b17f77a0dd3c4",
    "filename": "tests/90jira/SYN-442.pl",
    "status": "modified",
    "additions": 24,
    "deletions": 9,
    "changes": 33,
    "blob_url": "https://github.com/matrix-org/sytest/blob/df3c76bcccc8cc5e632f9127a52e6977a7847248/tests/90jira/SYN-442.pl",
    "raw_url": "https://github.com/matrix-org/sytest/raw/df3c76bcccc8cc5e632f9127a52e6977a7847248/tests/90jira/SYN-442.pl",
    "contents_url": "https://api.github.com/repos/matrix-org/sytest/contents/tests/90jira/SYN-442.pl?ref=df3c76bcccc8cc5e632f9127a52e6977a7847248",
    "patch": "@@ -24,9 +24,14 @@\n \n          await_event_for( $user_2, sub {\n             my ( $event ) = @_;\n-            return 0 unless $event->{type} eq \"m.room.member\";\n-            return 0 unless $event->{content}->{membership} eq \"invite\";\n-            return 0 unless $event->{room_id} eq $room_id;\n+\n+            $event->{type} eq \"m.room.member\" or\n+               return 0;\n+            $event->{content}->{membership} eq \"invite\" or\n+               return 0;\n+            $event->{room_id} eq $room_id or\n+               return 0;\n+\n             return 1;\n          })->SyTest::pass_on_done( \"User B received the invite from A\" )\n       })->then( sub {\n@@ -48,9 +53,14 @@\n \n          await_event_for( $user_2, sub {\n             my ( $event ) = @_;\n-            return 0 unless $event->{type} eq \"m.room.member\";\n-            return 0 unless $event->{content}->{membership} eq \"leave\";\n-            return 0 unless $event->{room_id} eq $room_id;\n+\n+            $event->{type} eq \"m.room.member\" or\n+               return 0;\n+            $event->{content}->{membership} eq \"leave\" or\n+               return 0;\n+            $event->{room_id} eq $room_id or\n+               return 0;\n+\n             return 1;\n          })->SyTest::pass_on_done( \"User B received the leave event\" )\n       })->then( sub {\n@@ -61,9 +71,14 @@\n \n          await_event_for( $user_1, sub {\n             my ( $event ) = @_;\n-            return 0 unless $event->{type} eq \"m.room.member\";\n-            return 0 unless $event->{content}->{membership} eq \"invite\";\n-            return 0 unless $event->{room_id} eq $room_id;\n+\n+            $event->{type} eq \"m.room.member\" or\n+               return 0;\n+            $event->{content}->{membership} eq \"invite\" or\n+               return 0;\n+            $event->{room_id} eq $room_id or\n+               return 0;\n+\n             return 1;\n          })->SyTest::pass_on_done( \"User A received the invite from user B\" )\n       })->then( sub {"
  }
]
